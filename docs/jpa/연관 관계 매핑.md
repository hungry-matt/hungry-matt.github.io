---
layout: default
title: 연관 관계 매핑
parent: JPA
---


Table of contents


- TOC
{:toc}


---

# 연관관계 매핑

테이블은 연관관계를 나타낼때 외래키를 사용하고 객체는 참조(주소)를 사용해서 관계를 맺는다.

객체 관계 매핑(ORM, Object Realational Mapping)에서 가장 어려운 부분이 객체 연관관계와 테이블 연관관계를 매핑하는 일이다.

연관관계 매핑을 이해하기 위해 다음 핵심 키워드를 이해하자.

## 방향(Direction)
- 단방향과, 양방향이 있다.
- 예를 들어 회원과 팀이 관계가 있을 때 회원 -> 팀, 팀 -> 회원 `둘 중 한 쪽만 참조하는 것을 단방향 관계`라 한다.
- 회원 -> 팀, 팀 -> `양쪽 모두 서로 참조하는 것을 양방향 관계`라 한다.
- 방향은 객체 관계에만 존재하며 `테이블 관계는 항상 양방향`이다.

## 다중성(Multiplicity)
- 다대일, 일대다, 일대일, 다대다 다중성이 있다.
- 예를 들어 회원과 팀이 관계가 있을 때 여러 회원은 한 팀에 속하므로 회원과 팀의 관계는 다대일 관계가 된다.
- 반대로 한 팀에 여러 회원이 소속 될 수 있으므로 회원과 팀의 관계는 일대다 관계가 된다.

## 연관관계의 주인(Owner)
- 객체를 양방향 연관관계로 만들면 연관관계의 주인을 정해야한다.

# 연관관계의 주인

두 객체의 연관관계중 하나를 정해서 테이블의 외래키를 관리해야 하는데 이 외래키를 관리 하는 객체를 `연관 관계의 주인`이라 한다.

## 양방향 매핑 규칙

양방향 매핑이란 양쪽에서 참조하는 것을 의미한다.

- 두 연관 관계중 연관 관계의 주인을 정해야 함

- 연관 관계의 주인만이 데이터베이스 연관 관계와 매핑되고 외래키를 등록, 수정, 삭제 할 수 있음

- 주인이 아닌 쪽은 읽기만 가능

- mappedBy 속성으로 연관 관계의 주인을 지정할 수 있음

- 연관 관계의 주인은 mappedBy 속성을 사용할 수 없음

```java
@Entity
public class Team {
    @Id
    @Column(name = "TEAM_ID")
    private Long id;

    private String name;

    // 연관 관계의 주인은 Member.team
    // Team 엔티티는 mappedBy를 통해 주인이 아님을 설정
    @OneToMany(mappedBy = "team") 
    private List<Member> members = new ArrayList<>();
}
```

- 항상 '다(N)'쪽이 외래키를 가진다.

- @ManyToOne은 항상 연관관계의 주인이 된다. (mappedBy 속성이 없다.)