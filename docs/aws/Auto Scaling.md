---
layout: default
title: AUto Scaling
parent: AWS
---

Table of contents

- TOC
{:toc}

---

# Auto Scaling Setting

오토스케일링은 네트워크 트래픽을 처리하는 로드밸런싱이 사용자가 설정한 임계치에 따라 인스턴스를 자동으로 생성과 삭제를 지원해주는 기술이다.

로드 밸런서 설정이 된 상태에서 시작한다.

## 시작 템플릿 생성

오토스케일링이 자동으로 인스턴스를 생성할 수 있게 템플릿을 만들어야한다.

![시작템플릿이름](/images/aws/시작템플릿이름.png)

- 시작 템플릿 이름만 작성하고 넘어간다.

![시작템플릿콘텐츠](/images/aws/시작템플릿콘텐츠.png)

- 사용할 AMI가 있다면 선택하여 템플릿에 포함 시켜준다.

- 인스턴스 유형은 상황에 맞게 선택한다.

- 키페어가 없다면 생성해주고 적절한 키페어를 선택해준다.

![네트워크설정](/images/aws/네트워크설정.png)

- 보통 VPC를 선택하며 사용할 보안 그룹을 선택한다.

- 보안 그룹은 복수 선택이 가능하다.

![사용자데이터](/images/aws/사용자데이터.png)

- 고급 세부 정보의 사용자 데이터에는 인스턴스 생성시 사용될 명령어를 추가할 수 있다.

- 예를들면, 오토스케일링에 의해 인스턴스가 자동으로 생성되면 실행될 애플리케이션이 없는 상태이다.

- CI/CD를 사용하고 있다면 S3에 저장되어 있는 최신 소스를 내려 받고 쉘 스크립트를 통해 실행할 수 있도록 명령어를 추가할 수 있다.

![IAM인스턴스프로파일](/images/aws/IAM인스턴스프로파일.png)

- 사용자 데이터를 통해 S3에 접근하게 된다면 권한이 필요하게 된다.

- IAM에서 S3로 접근할 수 있게 정책을 생성할 수 있다.

- 고급 세부 정보에서 IAM을 선택한다.

## Auto Scaling Group 생성

### 시작 템플릿 또는 구성 선택

![시작템플릿또는구성선택](/images/aws/시작템플릿또는구성선택.png)

- 오토스케일링 그룹 이름을 입력한다.

- 앞에서 만들었던 시작 템플릿을 선택한다.

- 버전은 템플릿을 수정할 때 마다 증가하며 증가된 템플릿 버전을 선택해야 최신 템플릿으로 적용된다.

### 설정 구성

![설정구성](/images/aws/설정구성.png)

- 인스턴스 구매 옵션에서 시작 템플릿 준수 선택시 인스턴스의 유형을 t3.medium으로 선택했다면 오토스케일링에서 인스턴스를 생성할 때 t3.medium 인스턴스만 생성하게 된다.

![인스턴스유형](/images/aws/설정구성2.png)

- 구매 옵션과 인스턴스 유형 조합은 인스턴스 생성 유형을 전략적으로 선택할 수 있다.

### 고급 옵션 구성

![고급옵션구성](/images/aws/고급옵션구성.png)

- 기존 로드 밸런서에 연결을 선택하여 오토스케일링을 적용할 대상 그룹을 포함시킨다.

![상태확인](/images/aws/상태확인.png)

- 오토스케일링은 로드 밸런서의 상태를 알아야 인스턴스를 생성할 수 있기 때문에 상태 확인에서 ELB를 선택하여 활성화 한다.

### 그룹 크기 및 조정 정책 구성

![그룹크기](/images/aws/그룹크기.png)

- 그룹 크기의 최대 용량은 3 정도로만 선택해주고 네트워크 트래픽에 따라 용량을 늘려준다. (용량을 너무 크게 잡으면 요금 폭탄을 맞을 수 있다.)

![조정정책](/images/aws/조정정책.png)

- 조정 정책은 인스턴스의 동적 생성에 대한 설정을 할 수 있다.

- 현재 입력된 정책은 CPU의 사용률이 80을 넘어서게 되면 인스턴스를 생성하게 된다.