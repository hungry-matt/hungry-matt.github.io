---
layout: default
title: 영속성 컨텍스트
parent: JPA
---


Table of contents


- TOC
{:toc}


---

# 영속성 컨텍스트

영속성이란 엔티티를 영구 저장한 환경 이다.

## 엔티티의 생명주기

### 비영속(new/transient)

영속성 컨텍스트와 전혀 관계가 없는 `새로운` 상태이다.

```java
//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId(1L);
member.setName("test");
```

### 영속(managed)

영속성 컨텍스트에 `관리`되는 상태이다.

```java
//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId(1L);
member.setName("test");

//emf -> EntityManagerFactory
EntityManager em = emf.createEntityManager();
em.getTransaction.().begin();

//객체를 저장한 상태(영속)
em.persist(member);
```

- 엔티티의 영속을 위해 EntityManager에 저장하며 데이터베이스에는 저장되지 않는다.

- 실제로 db에 저장되는 것은 transaction commit 시 동작한다.

### 준영속(detached)

영속성 컨텍스트에 저장 되었다가 `분리`된 상태이다.

```java
em.detach(member);
```

- 엔티티를 영속성에서 분리할 때 사용된다.

### 삭제(removed)

삭제된 상태이다.

```java
em.remove(member);
```

- 영속성 및 데이터베이스에서 삭제할 때 사용된다.